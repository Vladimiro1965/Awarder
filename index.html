<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Наявність деталей</title>
<style>
  body{font-family:'Segoe UI',sans-serif;background:#e6e6e6;margin:0;padding:0;color:#111;}
  h1{text-align:center;margin:20px;font-size:28px;}
  .badge-container{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin:10px;}
  .badge{padding:8px 14px;border-radius:8px;background:#f5f5f5;font-weight:600;cursor:pointer;transition:transform .2s;}
  .badge.green{background:#d8f8d8;}
  .badge.red{background:#ffd8d8;}
  .badge:hover{transform:scale(1.05);}
  .container{display:flex;flex-wrap:wrap;justify-content:center;gap:30px;max-width:1200px;margin:auto;padding:0 20px 30px;}
  .left,.right{background:#fff;border-radius:12px;box-shadow:0 2px 5px rgba(0,0,0,.05);padding:20px;flex:1;min-width:300px;}
  .subtitle{font-size:20px;font-weight:600;text-align:center;margin-bottom:15px;}
  .model-list{display:flex;flex-direction:column;gap:8px;max-height:500px;overflow:auto;}
  .model-item{display:flex;align-items:center;padding:10px;border:1px solid #ddd;border-radius:12px;background:#fff;cursor:pointer;transition:.2s;}
  .model-item:hover,.highlight{transform:scale(1.02);border-color:#007bff;background:#e2f4ff;}
  .model-item img{height:50px;margin-right:12px;}
  .search-box{display:flex;gap:10px;margin-bottom:15px;}
  .search-box input{flex:1;padding:10px;border:1px solid #ccc;border-radius:8px;}
  .search-box button{padding:10px 20px;background:#111;color:#fff;border:none;border-radius:8px;cursor:pointer;}
  #resultsTable{width:100%;border-collapse:collapse;margin-top:10px;}
  #resultsTable th,td{padding:8px;border:1px solid #eee;text-align:center;}
  img.cell-img{max-height:60px;cursor:pointer;}
  tr.zero-stock{background:#ffecec;}
  .total-info{margin-top:12px;font-weight:500;text-align:right;}
  @media(max-width:768px){.container{flex-direction:column;} .badge-container{justify-content:flex-start;padding:0 10px;}}
</style>
</head>
<body>
<h1>Наявність деталей для індивідуального годинника</h1>
<div class="badge-container" id="badgeContainer"></div>
<div class="container">
  <div class="left">
    <div class="subtitle">Доступні моделі годинників</div>
    <div class="model-list" id="modelList"></div>
  </div>
  <div class="right">
    <div class="subtitle">Пошук за артикулом</div>
    <div class="search-box">
      <input id="watchInput" placeholder="Введіть артикул, напр. 1202-0252"/>
      <button onclick="searchParts()">Пошук</button>
    </div>
    <div id="loader" style="display:none;">Завантаження...</div>
    <div id="noResults" style="display:none;font-style:italic;text-align:center;">Не знайдено.</div>
    <table id="resultsTable" style="display:none;"><thead>
      <tr><th>Фото</th><th>Артикул</th><th>Назва</th><th>Прихід</th><th>Розхід</th><th>Залишок</th></tr>
    </thead><tbody></tbody></table>
    <div class="total-info" id="summary" style="display:none;"></div>
  </div>
</div>

<script>
const models = ["020","021","022","023","024","025","026","027","028","030","032","033","035","040","041","043","045","047","049","050","053","055","058"];
const greenModels = ["020","021","022","023","024","025","026","028","032","035","040","041","043","049","050","053","055"];
const redModels = ["027","030","033","045","047","058"];

function createBadges(){
  const c = document.getElementById('badgeContainer');
  models.forEach(m=>{
    const b=document.createElement('div');
    b.className=`badge ${greenModels.includes(m)?'green':redModels.includes(m)?'red':''}`;
    b.innerText=m;
    b.onclick=()=>scrollToModel(m);
    c.appendChild(b);
  });
}

function scrollToModel(code){
  const items=document.querySelectorAll('.model-item');
  items.forEach(item=>{
    if(item.textContent.includes(code)){
      item.scrollIntoView({behavior:'smooth',block:'center'});
      item.classList.add('highlight');
      setTimeout(()=>item.classList.remove('highlight'),1500);
    }
  });
}

async function loadModels(){
  const res = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/1VE0UbNuQu0f9BfmkRbKuQpa5xQr9q8XGUKGXmCkxwwI/values/Годинники!A:D?key=AIzaSyB2l87TIEyJwO1BMDkE_IHMaXG6k2N3rEw`);
  const data = await res.json();
  const rows = data.values.slice(1);
  const list = document.getElementById('modelList');

  rows.forEach(r=>{
    const art=(r[2]||'').trim(), name=(r[3]||'').trim();
    if(!/^(?:1201|1202)-/.test(art)) return;
    if(/^(?:Сталевий браслет|Годинник наручний)/.test(name)) return;
    const model = art.split('-')[0].slice(-3);
    const img=`https://abertime.com.ua/image/data/price_google/all_price/big/SK-${art}.jpg`;
    const div=document.createElement('div');
    div.className='model-item';
    div.onclick=()=>{document.getElementById('watchInput').value=art;searchParts();scrollToModel(model);};
    div.innerHTML=`<img src="${img}"><div><strong>${art}</strong> — ${name}</div>`;
    list.appendChild(div);
  });
}

async function searchParts(){
  const inp=document.getElementById('watchInput').value.trim();
  const loader=document.getElementById('loader'), no=document.getElementById('noResults'),
        tbl=document.getElementById('resultsTable'), body=tbl.querySelector('tbody'),
        sumEl=document.getElementById('summary');
  loader.style.display='block'; no.style.display='none'; tbl.style.display='none'; sumEl.style.display='none';
  const L = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/1VE0UbNuQu0f9BfmkRbKuQpa5xQr9q8XGUKGXmCkxwwI/values/Комплектації!A:D?key=AIzaSyB2l87TIEyJwO1BMDkE_IHMaXG6k2N3rEw`);
  const link = (await L.json()).values.slice(1).filter(r=>r[1].trim()===inp).map(r=>r[3].trim());
  if(!link.length){loader.style.display='none'; no.style.display='block'; return;}
  const D = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/.../Деталі!A:F?key=...`);
  const S = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/.../Залишки!A:G?key=...`);
  const detail=(await D.json()).values.slice(1);
  const stock=(await S.json()).values.slice(1);
  body.innerHTML=''; let totalQty=0;
  link.forEach(a=>{
    const d = detail.find(r=>r[1].trim()===a)||[];
    const sVal = parseInt(d[5]||'0',10)||0;
    totalQty+=sVal;
    const img = `https://abertime.com.ua/.../SK-${a}.jpg`;
    const isZero = sVal===0;
    body.innerHTML+=`
      <tr class="${isZero?'zero-stock':''}">
        <td><img src="${img}" class="cell-img"></td>
        <td>${a}</td>
        <td>${(d[2]||'').trim()}</td>
        <td>${(d[3]||'')}</td><td>${(d[4]||'')}</td><td>${(d[5]||'')}</td>
      </tr>`;
  });
  loader.style.display='none'; tbl.style.display='table';
  sumEl.innerText=`Деталей: ${link.length} | Залишок: ${totalQty}`;
  sumEl.style.display='block';
}

document.getElementById('watchInput').addEventListener('keydown', e=>{if(e.key==='Enter') searchParts();});

window.onload=()=>{
  createBadges();
  loadModels();
};
</script>
</body>
</html>
